# Windowsæž„å»ºä¸­æ–­é—®é¢˜ä¿®å¤æŒ‡å—

## ðŸš¨ é—®é¢˜æè¿°

åœ¨WindowsçŽ¯å¢ƒä¸‹ä½¿ç”¨PyInstalleræž„å»ºæ—¶é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š

```
âœ… ä¾èµ–å®‰è£…å®Œæˆ 
å¼€å§‹æž„å»ºå¯æ‰§è¡Œæ–‡ä»¶... 
å°è¯•æž„å»º 1/2... 
ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æž„å»º... 
Aborted by user request. 
âš ï¸ æž„å»ºå°è¯• 1 å¤±è´¥ï¼Œé”™è¯¯ä»£ç : 1 
ç­‰å¾…5ç§’åŽé‡è¯•... 
ERROR: Input redirection is not supported, exiting the process immediately. 
Terminate batch job (Y/N)? 
å°è¯•æž„å»º 2/2... 
ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æž„å»º... 
âš ï¸ æž„å»ºå°è¯• 2 å¤±è´¥ï¼Œé”™è¯¯ä»£ç : -1073741510 
Terminate batch job (Y/N)? 
âŒ æ‰€æœ‰æž„å»ºå°è¯•éƒ½å¤±è´¥äº† 
æž„å»ºå¤±è´¥ï¼Œé”™è¯¯ä»£ç : 1
```

## ðŸ” é—®é¢˜åˆ†æž

### æ ¹æœ¬åŽŸå› 
1. **äº¤äº’å¼è¾“å…¥è¯·æ±‚**ï¼šPyInstalleråœ¨æŸäº›æƒ…å†µä¸‹ä¼šè¯·æ±‚ç”¨æˆ·ç¡®è®¤
2. **è¾“å…¥é‡å®šå‘ä¸æ”¯æŒ**ï¼š`echo y |` ç®¡é“åœ¨æŸäº›WindowsçŽ¯å¢ƒä¸‹ä¸å·¥ä½œ
3. **è¿›ç¨‹ä¸­æ–­ä¿¡å·**ï¼šæž„å»ºè¿‡ç¨‹è¢«æ„å¤–çš„ä¸­æ–­ä¿¡å·ç»ˆæ­¢
4. **é”™è¯¯ä»£ç -1073741510**ï¼šè¡¨ç¤ºè¿›ç¨‹è¢«å¼ºåˆ¶ç»ˆæ­¢ï¼ˆCTRL+Cæˆ–ç±»ä¼¼ä¿¡å·ï¼‰

### è§¦å‘æ¡ä»¶
- Windowsæ‰¹å¤„ç†è„šæœ¬ä¸­ä½¿ç”¨ `echo y | pyinstaller`
- PyInstalleré‡åˆ°éœ€è¦ç”¨æˆ·ç¡®è®¤çš„æƒ…å†µ
- ç³»ç»Ÿæˆ–CIçŽ¯å¢ƒä¸æ”¯æŒè¾“å…¥é‡å®šå‘
- æž„å»ºè¿‡ç¨‹ä¸­çš„èµ„æºå†²çªæˆ–æƒé™é—®é¢˜

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨ä¿®å¤ç‰ˆæž„å»ºè„šæœ¬ï¼ˆæŽ¨èï¼‰

ä½¿ç”¨æ–°åˆ›å»ºçš„ `build_windows_fixed.bat` è„šæœ¬ï¼š

```batch
build_windows_fixed.bat
```

#### ä¿®å¤ç‰¹æ€§ï¼š
- âœ… **å®Œå…¨éžäº¤äº’å¼**ï¼šä½¿ç”¨ `python -m PyInstaller` è€Œä¸æ˜¯ç›´æŽ¥è°ƒç”¨
- âœ… **çŽ¯å¢ƒå˜é‡è®¾ç½®**ï¼šè®¾ç½® `PYTHONUNBUFFERED=1` é¿å…ç¼“å†²é—®é¢˜
- âœ… **é”™è¯¯é‡å®šå‘**ï¼šå°†é”™è¯¯è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶è€Œä¸æ˜¯æŽ§åˆ¶å°
- âœ… **æ™ºèƒ½é‡è¯•**ï¼šæœ€å¤š3æ¬¡å°è¯•ï¼Œæ¯æ¬¡æ¸…ç†ä¹‹å‰çš„å¤±è´¥æ–‡ä»¶
- âœ… **è¯¦ç»†æ—¥å¿—**ï¼šæä¾›æž„å»ºè¿‡ç¨‹çš„è¯¦ç»†ä¿¡æ¯
- âœ… **è·¯å¾„æ˜Žç¡®**ï¼šæ˜Žç¡®æŒ‡å®šæ‰€æœ‰è¾“å‡ºå’Œå·¥ä½œè·¯å¾„

### æ–¹æ¡ˆ2ï¼šä¿®å¤çŽ°æœ‰æž„å»ºè„šæœ¬

å¦‚æžœè¦ç»§ç»­ä½¿ç”¨ `build_windows.bat`ï¼Œå·²è¿›è¡Œä»¥ä¸‹ä¿®å¤ï¼š

1. **æ·»åŠ éžäº¤äº’å¼å‚æ•°**ï¼š
   ```batch
   echo y | pyinstaller pyinstaller_windows.spec --noconfirm --clean --log-level=WARN --distpath=dist --workpath=build
   ```

2. **æ˜Žç¡®æŒ‡å®šè·¯å¾„**ï¼š
   - `--distpath=dist`ï¼šæŒ‡å®šè¾“å‡ºç›®å½•
   - `--workpath=build`ï¼šæŒ‡å®šå·¥ä½œç›®å½•

### æ–¹æ¡ˆ3ï¼šæ‰‹åŠ¨æž„å»ºï¼ˆè°ƒè¯•ç”¨ï¼‰

å¦‚æžœè‡ªåŠ¨è„šæœ¬ä»æœ‰é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

```batch
# æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒ
call venv_py311\Scripts\activate.bat

# å®‰è£…ä¾èµ–
python -m pip install --upgrade pip
python -m pip install -r requirements.txt
python -m pip install pyinstaller

# æ¸…ç†
rmdir /s /q build dist
mkdir dist\windows

# æž„å»º
python -m PyInstaller pyinstaller_windows.spec --noconfirm --clean --log-level=ERROR

# æ£€æŸ¥ç»“æžœ
dir dist\windows
```

## ðŸ› ï¸ é¢„é˜²æŽªæ–½

### 1. çŽ¯å¢ƒé…ç½®
```batch
# è®¾ç½®çŽ¯å¢ƒå˜é‡
set PYTHONUNBUFFERED=1
set PYTHONDONTWRITEBYTECODE=1
set PYINSTALLER_CONFIG_DIR=%TEMP%\pyinstaller
```

### 2. ä½¿ç”¨Pythonæ¨¡å—è°ƒç”¨
```batch
# æŽ¨èæ–¹å¼
python -m PyInstaller [å‚æ•°]

# é¿å…ç›´æŽ¥è°ƒç”¨
pyinstaller [å‚æ•°]
```

### 3. é”™è¯¯å¤„ç†
```batch
# é‡å®šå‘é”™è¯¯åˆ°æ–‡ä»¶
pyinstaller [å‚æ•°] 2>build_error.log

# æ£€æŸ¥é”™è¯¯
if exist "build_error.log" type build_error.log
```

## ðŸ“‹ éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥çŽ¯å¢ƒ
```batch
python --version
python -m pip list | findstr pyinstaller
```

### 2. æµ‹è¯•æž„å»º
```batch
# ä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬
build_windows_fixed.bat

# æ£€æŸ¥è¾“å‡º
dir dist\windows\*.exe
```

### 3. éªŒè¯å¯æ‰§è¡Œæ–‡ä»¶
```batch
# è¿è¡Œç”Ÿæˆçš„exeæ–‡ä»¶
dist\windows\å°å®å·¥å…·é›†ä¹‹ç‚¹å‡»å™¨.exe
```

## ðŸ”§ æ•…éšœæŽ’é™¤

### é—®é¢˜1ï¼šä»ç„¶å‡ºçŽ°äº¤äº’å¼æç¤º
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `build_windows_fixed.bat` è„šæœ¬
- ç¡®ä¿ä½¿ç”¨ `python -m PyInstaller` è°ƒç”¨æ–¹å¼
- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–è¿›ç¨‹å ç”¨æ–‡ä»¶

### é—®é¢˜2ï¼šæƒé™é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤æç¤ºç¬¦
- æ£€æŸ¥é˜²ç—…æ¯’è½¯ä»¶æ˜¯å¦é˜»æ­¢æ–‡ä»¶åˆ›å»º
- ç¡®ä¿ç›®æ ‡ç›®å½•æœ‰å†™å…¥æƒé™

### é—®é¢˜3ï¼šä¾èµ–ç¼ºå¤±
**è§£å†³æ–¹æ¡ˆ**ï¼š
- é‡æ–°å®‰è£…è™šæ‹ŸçŽ¯å¢ƒï¼š`python -m venv venv_py311`
- å‡çº§pipï¼š`python -m pip install --upgrade pip`
- é‡æ–°å®‰è£…ä¾èµ–ï¼š`pip install -r requirements.txt`

### é—®é¢˜4ï¼šæž„å»ºæ–‡ä»¶è¿‡å¤§
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `pyinstaller_windows.spec` é…ç½®æ–‡ä»¶
- æ·»åŠ æ›´å¤šæŽ’é™¤æ¨¡å—åˆ° `excludes` åˆ—è¡¨
- è€ƒè™‘ä½¿ç”¨ `--onedir` è€Œä¸æ˜¯ `--onefile`

## ðŸ“Š æ€§èƒ½ä¼˜åŒ–

### æž„å»ºæ—¶é—´ä¼˜åŒ–
- ä½¿ç”¨specæ–‡ä»¶è€Œä¸æ˜¯å‘½ä»¤è¡Œå‚æ•°
- å¯ç”¨æž„å»ºç¼“å­˜
- æŽ’é™¤ä¸å¿…è¦çš„æ¨¡å—

### æ–‡ä»¶å¤§å°ä¼˜åŒ–
- ä½¿ç”¨UPXåŽ‹ç¼©ï¼ˆå¦‚æžœå…¼å®¹ï¼‰
- æŽ’é™¤å¤§åž‹åº“ï¼ˆnumpy, matplotlibç­‰ï¼‰
- ä½¿ç”¨ `--strip` å‚æ•°

## ðŸ“ˆ ç›‘æŽ§æŒ‡æ ‡

- âœ… æž„å»ºæˆåŠŸçŽ‡ > 95%
- âœ… æž„å»ºæ—¶é—´ < 10åˆ†é’Ÿ
- âœ… å¯æ‰§è¡Œæ–‡ä»¶å¤§å° < 80MB
- âœ… å¯åŠ¨æ—¶é—´ < 5ç§’

## ðŸ”® åŽç»­æ”¹è¿›

1. **CI/CDé›†æˆ**ï¼šåœ¨GitHub Actionsä¸­ä½¿ç”¨ä¿®å¤ç‰ˆè„šæœ¬
2. **è‡ªåŠ¨æµ‹è¯•**ï¼šæž„å»ºåŽè‡ªåŠ¨è¿è¡ŒåŸºæœ¬åŠŸèƒ½æµ‹è¯•
3. **ç¼“å­˜ä¼˜åŒ–**ï¼šç¼“å­˜PyInstalleræž„å»ºäº§ç‰©
4. **å¹¶è¡Œæž„å»º**ï¼šåˆ†ç¦»ä¾èµ–å®‰è£…å’Œæž„å»ºæ­¥éª¤

---

**æ›´æ–°æ—¶é—´**ï¼š2024å¹´12æœˆ
**é€‚ç”¨ç‰ˆæœ¬**ï¼šPyInstaller 5.0+, Python 3.9-3.12
**æµ‹è¯•çŽ¯å¢ƒ**ï¼šWindows 10/11, GitHub Actions